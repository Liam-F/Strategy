Sub Powerpoint_Presentation_Creation()    Dim icount As Integer    Dim vStocks() As Variant        icount = 0    While Sheets("3. Volatilities").Range("B3").Offset(icount, 0) <> ""        icount = icount + 1    Wend        ReDim vStocks(1 To icount, 1 To 2)        Dim i As Integer        For i = 1 To icount        vStocks(i, 1) = Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value        vStocks(i, 2) = Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value    Next i        Sheets("3. Volatilities").Range("LastCreated").Resize(50, 2).ClearContents    For i = 1 To icount            Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vStocks(i, 1)            Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = vStocks(i, 2)            Sheets("3. Volatilities").Range("LastCreated").Offset(i - 1, 0).Value = vStocks(i, 1)            Sheets("3. Volatilities").Range("LastCreated").Offset(i - 1, 1).Value = vStocks(i, 2)    Next i        If icount <= 16 Then        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        Call Update_One_pager(1)    Else        Sheets("3. Volatilities").Range("LastCreated").Resize(50, 2).ClearContents        For i = 1 To icount            Sheets("3. Volatilities").Range("LastCreated").Offset(i - 1, 0).Value = vStocks(i, 1)            Sheets("3. Volatilities").Range("LastCreated").Offset(i - 1, 1).Value = vStocks(i, 2)         Next i                        Call Update_LongPpt(icount)           End If    For i = 1 To UBound(vStocks, 1)        Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vStocks(i, 1)        Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = vStocks(i, 2)    Next i            Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")    Sheets("3. Volatilities").Activate        Application.StatusBar = False    End SubSub Update_One_pager(iShortppt)    Dim wCurrentWbk As Workbook    Dim iSlideWidth As Double    Dim iSlideHeight As Double    Dim sClientName As String    Dim sUniverse As String    Set wCurrentWbk = ActiveWorkbook        Application.ScreenUpdating = False        iStock_Number_Template = 15        Application.StatusBar = "Launch Vol Analysis"            'get the client and universe name    sClientName = ActiveWorkbook.Sheets("3. Volatilities").Range("Client").Value    sUniverse = ActiveWorkbook.Sheets("3. Volatilities").Range("Universe").Value        ' Look for the path to the powerpoint presentations    Path = wCurrentWbk.Sheets("3. Volatilities").Range("Path_ppt").Value    File = wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_File").Value    Location = Path & File        'Open the generic one pager powerpoint    Dim genericPowerPoint As Object    Set genericPowerPoint = CreateObject("PowerPoint.Application")    genericPowerPoint.Visible = True    genericPowerPoint.Presentations.Open Location    iSlideWidth = genericPowerPoint.Presentations(File).PageSetup.Slidewidth    iSlideHeight = genericPowerPoint.Presentations(File).PageSetup.SlideHeight    'rename slides from 0 to N-1    'NB: the first loop enables to handle cases when the user added to slides to the template    'Indeed in this case, ppt automatically names the new Slide N+1, so it could create a bug when we rename    k = 0    For Each Slides In genericPowerPoint.Presentations(File).Slides        Slides.name = k        k = k + 1000    Next    'now we are sure there is not slide before slide k that has "k" as name    k = 0    For Each Slides In genericPowerPoint.Presentations(File).Slides        Slides.name = k        k = k + 1    Next            Dim iStockNumber As Integer    'StockNumber is the number of stock in the shape we will paste in ppt    'It enable to compute the right size for each shape    iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value        'variables for size and positionning    Dim hgt As Double    Dim width, left, top As Double            'update fund name    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        With genericPowerPoint.Presentations(File).Slides("5").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        '****************************************************************************************        '*************** Slide 0 : Implied vs realized => update graphs and tables        '*****************************************************************************************        Application.StatusBar = "Powerpoint: slide 0"            'Update title    maturity_RVIV = CStr(Range("maturity_RV").Value)    stitle_graph = maturity_RVIV & "D REALIZED VOLATILITY*"    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value & "*"    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Font.Size = 13        'Update date    Dim m_date As Date: m_date = wCurrentWbk.Sheets("3. Volatilities").Range("m_date").Value    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Data")        .TextFrame.TextRange.Text = "Data from Bloomberg as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    End With    genericPowerPoint.Presentations(File).Slides("0").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("5").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("1").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))        'update legend    If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Alphabetic" Then        Sorted_By = "*Sorted alphabetically"    Else        Sorted_By = "*Sorted by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value)    End If    genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By        ' update color scale    With genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorV")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorV").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("B2").Resize(iStockNumber, 1).CopyPicture    'wCurrentWbk.Sheets("Color Scales").Range("B2").Resize(5, 1).CopyPicture    'Debug.Print (iStockNumber)    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)            .LockAspectRatio = False        .name = "ColorV"        .Height = hgt        .width = width        .left = left        .top = top    End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorH")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorH").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("D2").Resize(1, iStockNumber).CopyPicture        'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)            .LockAspectRatio = False        .name = "ColorH"        .Height = hgt        .width = width        .left = left        .top = top            End With               ' The all implied vs realized        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All")            hgt = .Height            left = .left            top = .top            width = .width        End With                genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All").Delete                'get the graph from excel        iOffset = (WorksheetFunction.Max(iStockNumber, 8) + 4)        wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 0).Resize(iStockNumber + 1, 6).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_All"            .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))            .width = width            .left = left            .top = top        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR")            .left = left + (width - .width) / 2        End With            ' The all implied       With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All")            hgt = .Height            left = .left            top = .top            width = .width        End With                       genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All").Delete              'get the graph from excel       wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(0, 0).Resize(iStockNumber + 1, 6).CopyPicture          Application.Wait (Now + TimeValue("00:00:01"))              'paste it into powerpoint             genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)          'look for the last shape added in powerpoint       icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count              'get the ratio       iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value              'set the name, position and size       With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                  .LockAspectRatio = False           .name = "Implied_All"           .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))           .left = left ' + width + (iSlideWidth - 2 * left - width - width * 7 / 8)           .width = width '* 7 / 8           .top = top       End With              With genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I")           .left = left + (width - .width) / 2       End With                     ' The ratio        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio")            hgt = .Height            width = .width            left = .left            top = .top        End With                genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio").Delete                'get the implied realized table  from excel        wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 7).Resize(iStockNumber + 1, 3).CopyPicture            Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)            .LockAspectRatio = False            .name = "Vol_Ratio"            .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))            .width = width            .left = left            .top = top            hgt = .Height                    End With                            'adapt the legend        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Color")            .top = top + hgt + 10        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1")            .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Color").top - genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1").Height * 0.5 + genericPowerPoint.Presentations(File).Slides("0").Shapes("Color").Height * 0.5        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By")            .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1").top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1").Height * 0.85        End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend2")            .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1").top        End With                            'The Implied vs Realized graph            'delete the graph in powerpoint                dBegin_position = genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").Height                        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_Chart")            previous_hgt = .Height            width = .width            left = .left            top = .top        End With                hgt = 0.95 * (genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorH").top - dBegin_position)                genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_Chart").Delete                'get the graph from excel        wCurrentWbk.Sheets("Vol_Scatter_Plots").Shapes("Volatility_Spread_ScatterPlot").Copy                'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                Dim Temp As Double        Dim dvariation As Double        'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_Chart"            .Height = previous_hgt            .width = width            .left = left                        dvariation = top            .top = dBegin_position + (genericPowerPoint.Presentations(File).Slides("0").Shapes("Colorh").top - dBegin_position - previous_hgt) / 2            dvariation = dvariation - .top            .LinkFormat.BreakLink        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorV")            .top = .top - dvariation ' genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_Chart").top + 10        End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("ColorH")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("CheapCarry")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("ExpensiveCarry")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("ExpensiveVolatility")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("0").Shapes("CheapVolatility")            .top = .top - dvariation '        End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Percentile_Expl")            .top = .top - dvariation '        End With                                     '****************************************************************************************        '*************** Slide 1 : Implied vs realized => update graphs and tables   2        '*****************************************************************************************    Application.StatusBar = "Powerpoint: slide 1"    'Update title    maturity_RVIV = CStr(Range("maturity_RV").Value)    stitle_graph = maturity_RVIV & "D REALIZED VOLATILITY*"    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_I").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value & "*"    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_I").TextFrame.TextRange.Font.Size = 13        'update legend    If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Alphabetic" Then        Sorted_By = "*Sorted alphabetically"    Else        If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Percentile" Then            Sorted_By = "*Sorted by current value"        Else            Sorted_By = "*Sorted by percentile"        End If    End If    genericPowerPoint.Presentations(File).Slides("1").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By        ' update color scale    With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorV")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorV").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("B2").Resize(iStockNumber, 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)            .LockAspectRatio = False        .name = "ColorV"        .Height = hgt        .width = width        .left = left        .top = top            End With        With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("D2").Resize(1, iStockNumber).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)            .LockAspectRatio = False        .name = "ColorH"        .Height = hgt        .width = width        .left = left        .top = top            End With                                                                ' The all implied vs realized        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_All")            hgt = .Height            left = .left            top = .top            width = .width        End With                genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_All").Delete                'get the graph from excel        iOffset = (WorksheetFunction.Max(iStockNumber, 8) + 4)        wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 2 * (iStockNumber + 1) + 6 + 7).Resize(iStockNumber + 1, 6).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_All"            .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))            .width = width            .left = left            .top = top                    End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR")            .left = left + (width - .width) / 2        End With            ' The all implied       With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_All")            hgt = .Height            left = .left            top = .top            width = .width        End With                       genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_All").Delete              'get the graph from excel       wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(0, 2 * (iStockNumber + 1) + 6 + 7).Resize(iStockNumber + 1, 6).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))                 'paste it into powerpoint             genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)          'look for the last shape added in powerpoint       icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count              'get the ratio       iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value              'set the name, position and size       With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)                  .LockAspectRatio = False           .name = "Implied_All"           .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))           .left = left ' + width + (iSlideWidth - 2 * left - width - width * 7 / 8)           .width = width '* 7 / 8           .top = top       End With              With genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_I")           .left = left + (width - .width) / 2       End With                     ' The ratio        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Vol_Ratio")            hgt = .Height            width = .width            left = .left            top = .top        End With                genericPowerPoint.Presentations(File).Slides("1").Shapes("Vol_Ratio").Delete                'get the implied realized table  from excel                wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 2 * (iStockNumber + 1) + 6 + 7 + 6 + 1).Resize(iStockNumber + 1, 3).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)            .LockAspectRatio = False            .name = "Vol_Ratio"            .Height = WorksheetFunction.Max(80, WorksheetFunction.Min(hgt * iStockNumber / iStock_Number_Template, 250))            .width = width            .left = left            .top = top            hgt = .Height        End With                            'adapt the legend        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Color")            .top = top + hgt + 10        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1")            .top = genericPowerPoint.Presentations(File).Slides("1").Shapes("Color").top - genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").Height * 0.5 + genericPowerPoint.Presentations(File).Slides("1").Shapes("Color").Height * 0.5        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("Sorted_By")            .top = genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").top + genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").Height * 0.85        End With        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend2")            .top = genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").top        End With                            'The Implied vs Realized graph            'delete the graph in powerpoint                dBegin_position = genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").top + genericPowerPoint.Presentations(File).Slides("1").Shapes("Legend1").Height                        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart")            previous_hgt = .Height            width = .width            left = .left            top = .top        End With                hgt = 0.95 * (genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH").top - dBegin_position)                genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart").Delete                'get the graph from excel        wCurrentWbk.Sheets("Vol_Scatter_Plots").Shapes("Volatility_Spread_ScatterPlot_Value").Copy        Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_Chart"            .Height = previous_hgt            .width = width            .left = left            dvariation = top            .top = dBegin_position + (genericPowerPoint.Presentations(File).Slides("1").Shapes("Colorh").top - dBegin_position - previous_hgt) / 2            dvariation = dvariation - .top            '.top = 0.5 * (iSlideHeight - top - genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All").Height - genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_Chart").Height)            '.top = .top + top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All").Height            .LinkFormat.BreakLink        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorV")            .top = .top - dvariation ' genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_Chart").top + 10        End With        With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("CheapCarry")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("ExpensiveCarry")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("ExpensiveVolatility")            .top = .top - dvariation '        End With                With genericPowerPoint.Presentations(File).Slides("1").Shapes("CheapVolatility")            .top = .top - dvariation '        End With                    '****************************************************************************************        '*************** Slide 1 : Implied Volatility Level => update graphs and tables        '*****************************************************************************************        Application.StatusBar = "Powerpoint: slide 2"        k = 1        'Update title        genericPowerPoint.Presentations(File).Slides("2").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value        genericPowerPoint.Presentations(File).Slides("2").Shapes("Title").TextFrame.TextRange.Font.Size = 13        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Title")            .left = (iSlideWidth - .width) / 2        End With        'update legend        If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then            Sorted_By = "Box Plot: sorted alphabetically, Table: sorted "        Else            Sorted_By = "Box Plot: sorted by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value) & ", Table: sorted "        End If                     If wCurrentWbk.Sheets("3. Volatilities").Range("Percentile_OrderBy").Value = "Alphabetic" Then            Sorted_By = Sorted_By & "alphabetically"        Else            Sorted_By = Sorted_By & "by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("Percentile_OrderBy").Value)        End If                       genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By       'date           genericPowerPoint.Presentations(File).Slides("2").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                'The box plot        'delete the graph in powerpoint        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart")            hgt = .Height            width = .width            left = .left            top = .top        End With                        genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart").Delete                'get the graph from excel        wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Implied_BoxPlot").Copy        Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count                'set the name, position and size        iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value                With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)            .LockAspectRatio = False            .name = "Implied_BoxChart"            .Height = hgt            .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 780)            .left = (iSlideWidth - .width) / 2            .top = top            .LinkFormat.BreakLink                    End With        Dim legend_left As Double        Dim legend_width As Double                            With genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend")            legend_left = .left            legend_width = .width        End With                With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile")            hgt = .Height            left = .left            top = .top            width = .width        End With                    genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile").Delete                'get the graph from excel        'iOffset = (WorksheetFunction.Max(iStockNumber, 8) + 4)        wCurrentWbk.Sheets("Vol Results").Range("N6").Resize(9, iStockNumber + 1).CopyPicture        'wCurrentWbk.Sheets("Vol Results").Range("Percentile_Implied").CopyPicture            Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count                'get the ratio                        'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)                .LockAspectRatio = False                .name = "Implied_Percentile"                .Height = hgt                .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 650)                width = .width                .left = (0.95 * iSlideWidth - width - legend_width) / 2 + 0.05 * iSlideWidth + legend_width'                        .Left = legend_left + 90 + (iSlideWidth - legend_left - 90 - width) / 2                .top = top        End With        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend")            .left = (0.95 * iSlideWidth - width - legend_width) / 2        End With                                    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart")            hgt = .Height            width = .width            left = .left            top = .top        End With        If (iSlideWidth - width - legend_left - legend_width) > 0.1 * iSlideWidth Then            With genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend")                .top = top + (top + hgt - top - genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend").Height) / 2                .left = (0.95 * iSlideWidth - genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend").width - genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart").width) / 2            End With            With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart")                .left = genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend").left + genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend").width + 0.05 * iSlideWidth            End With                        'center below box chart            With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile")                .left = genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart").left + (genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart").width - genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile").width) / 2            End With                                    'put second legend next to percentile table            With genericPowerPoint.Presentations(File).Slides("2").Shapes("LegendP")                .left = genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend").left                .top = genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile").top + (genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Percentile").Height - .Height) / 2            End With                    End If                        '****************************************************************************************        '*************** Slide 2 : Term structure Level => update graphs and tables    '*****************************************************************************************    Application.StatusBar = "Powerpoint: slide 3"   'Update title    genericPowerPoint.Presentations(File).Slides("3").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title3").Value    genericPowerPoint.Presentations(File).Slides("3").Shapes("Title").TextFrame.TextRange.Font.Size = 13    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Title")        .left = (iSlideWidth - .width) / 2    End With    k = 1   'date   genericPowerPoint.Presentations(File).Slides("3").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    'update legend    genericPowerPoint.Presentations(File).Slides("3").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By       'The box plot    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart")        hgt = .Height        width = .width        left = .left        top = .top    End With            genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart").Delete        'get the graph from excel    wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Term_Structure_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)        'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)            .LockAspectRatio = False        .name = "TS_BoxChart"        .Height = hgt        .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 780)         width = .width        .left = (iSlideWidth - width) / 2        .top = top        .LinkFormat.BreakLink            End With    ' The percentile table      With genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile")          hgt = .Height          width = .width          left = .left          top = .top      End With            genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile").Delete            'get the graph from excel      iOffset = 2 * (WorksheetFunction.Max(iStockNumber, 8) + 4)      wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 0).Resize(9, iStockNumber + 1).CopyPicture      Application.Wait (Now + TimeValue("00:00:01"))            'paste it into powerpoint           genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)        'look for the last shape added in powerpoint      icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count            'set the name, position and size      With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)                .LockAspectRatio = False          .name = "TS_Percentile"          .Height = hgt          .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 650)          width = .width          .left = (0.95 * iSlideWidth - width - legend_width) / 2 + 0.05 * iSlideWidth + legend_width'                        .Left = legend_left + 90 + (iSlideWidth - legend_left - 90 - width) / 2          .top = top      End With      With genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend")          .left = (0.95 * iSlideWidth - width - legend_width) / 2      End With          With genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart")                hgt = .Height                width = .width                left = .left                top = .top    End With    If (iSlideWidth - width - legend_left - legend_width) > 0.1 * iSlideWidth Then                        With genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend")            .top = top + (top + hgt - top - genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend").Height) / 2            .left = (0.95 * iSlideWidth - genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend").width - genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart").width) / 2        End With        With genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart")            .left = genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend").left + genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend").width + 0.05 * iSlideWidth        End With                'center below box chart        With genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile")            .left = genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart").left + (genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_BoxChart").width - genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile").width) / 2        End With        With genericPowerPoint.Presentations(File).Slides("3").Shapes("LegendP")            .left = genericPowerPoint.Presentations(File).Slides("3").Shapes("Legend").left            .top = genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile").top + (genericPowerPoint.Presentations(File).Slides("3").Shapes("TS_Percentile").Height - .Height) / 2        End With    End If            '****************************************************************************************        '*************** Slide 4 : Term structure Level => update graphs and tables        '*****************************************************************************************        Application.StatusBar = "Powerpoint: slide 4"       'Update title        genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title4").Value        genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Font.Size = 13        With genericPowerPoint.Presentations(File).Slides("4").Shapes("Title")            .left = (iSlideWidth - .width) / 2        End With       'date       genericPowerPoint.Presentations(File).Slides("4").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))        'update legend        genericPowerPoint.Presentations(File).Slides("4").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By               'The Implied vol top table        'delete the graph in powerpoint        With genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart")            hgt = .Height            width = .width            left = .left            top = .top        End With                        genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart").Delete                'get the graph from excel        wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Smile_BoxPlot").Copy        Application.Wait (Now + TimeValue("00:00:01"))                        'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)                    .LockAspectRatio = False            .name = "Smile_BoxChart"            .Height = hgt            .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 780)            .left = (iSlideWidth - .width) / 2            .top = top            .LinkFormat.BreakLink        End With            ' The percentile table        With genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile")            hgt = .Height            width = .width            left = .left            top = .top        End With                genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile").Delete                'get the graph from excel        iOffset = 3 * (WorksheetFunction.Max(iStockNumber, 8) + 4)        wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 0).Resize(9, iStockNumber + 1).CopyPicture        Application.Wait (Now + TimeValue("00:00:01"))                   'paste it into powerpoint               genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)            'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)            .LockAspectRatio = False            .name = "Smile_Percentile"            .Height = hgt            .width = WorksheetFunction.Min(width * iStockNumber / iStock_Number_Template, 650)            width = .width            .left = (0.95 * iSlideWidth - width - legend_width) / 2 + 0.05 * iSlideWidth + legend_width'                        .Left = legend_left + 90 + (iSlideWidth - legend_left - 90 - width) / 2            .top = top        End With        With genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend")            .left = (0.95 * iSlideWidth - width - legend_width) / 2        End With                            With genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart")            hgt = .Height            width = .width            left = .left            top = .top                    End With        If (iSlideWidth - width - legend_left - legend_width) > 0.1 * iSlideWidth Then                               With genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend")                .top = top + (top + hgt - top - genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend").Height) / 2                .left = (0.95 * iSlideWidth - genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend").width - genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart").width) / 2            End With            With genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart")                .left = genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend").left + genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend").width + 0.05 * iSlideWidth                            End With                        'center below box chart            With genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile")                .left = genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart").left + (genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_BoxChart").width - genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile").width) / 2                            End With            With genericPowerPoint.Presentations(File).Slides("4").Shapes("LegendP")                .left = genericPowerPoint.Presentations(File).Slides("4").Shapes("Legend").left                .top = genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile").top + (genericPowerPoint.Presentations(File).Slides("4").Shapes("Smile_Percentile").Height - .Height) / 2            End With        End If                'kill all links between ppt and excel                Application.StatusBar = "Powerpoint: saved"        dt = Format(CStr(Now), "yyy_mm_dd_hh_mm_ss")        genericPowerPoint.Presentations(File).SaveAs (Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx")        If iShortppt = 1 Then            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(0, 1).Value = Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx"            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(1, 1).Value = ""        Else            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(1, 1).Value = Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx"        End If                genericPowerPoint.Presentations("Screener_Report_" & sClientName & "_" & dt & ".pptx").Close        genericPowerPoint.QuitEnd SubSub Update_LongPpt(iStock1)    Dim wCurrentWbk As Workbook    Set wCurrentWbk = ActiveWorkbook    Dim sClientName As String    sClientName = ActiveWorkbook.Sheets("3. Volatilities").Range("Client").Value    Dim sUniverse As String    sUniverse = ActiveWorkbook.Sheets("3. Volatilities").Range("Universe").Value    Dim hgt As Double    Dim width, left, top, iSlideWidth As Double        Dim iStock_Number_Template As Integer        iStock_Number_Template = 32        Application.ScreenUpdating = False    'Long ppt presentation: we first run the whole ticker list to create slides 1 and 2    Application.StatusBar = "Launch Vol Analysis"    '******************************************************************************************    'PART I : do analysis for all tickers    '******************************************************************************************    Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        ' Look for the path to the powerpoint presentations    Path = wCurrentWbk.Sheets("3. Volatilities").Range("Path_ppt").Value    File = wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_File").Value    Location = Path & "Template_Report_Long_test.pptx"        Dim genericPowerPoint As Object    Set genericPowerPoint = CreateObject("PowerPoint.Application")        genericPowerPoint.Visible = True        'Open the generic powerpoint long version    File = "Template_Long_Report.pptx"    Location = Path & File    genericPowerPoint.Presentations.Open Location    'rename slides    k = 0    For Each Slides In genericPowerPoint.Presentations(File).Slides        Slides.name = k        k = k + 1    Next    iSlideWidth = genericPowerPoint.Presentations(File).PageSetup.Slidewidth        'update fund name'    Dim hgt As Double'    Dim width, Left, top As Double        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName           End With    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName           End With    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName           End With    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("6").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName            End With    With genericPowerPoint.Presentations(File).Slides("6").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("7").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName           End With    With genericPowerPoint.Presentations(File).Slides("7").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("8").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName     End With    With genericPowerPoint.Presentations(File).Slides("8").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("9").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName     End With    With genericPowerPoint.Presentations(File).Slides("9").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("10").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName     End With    With genericPowerPoint.Presentations(File).Slides("10").Shapes("Universe")        .TextFrame.TextRange.Text = "Universe: " & sUniverse    End With        'Update date        Dim m_date As Date: m_date = wCurrentWbk.Sheets("3. Volatilities").Range("m_date").Value    'dates    genericPowerPoint.Presentations(File).Slides("0").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("1").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("2").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("3").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("4").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("5").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("6").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("7").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("8").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("9").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    genericPowerPoint.Presentations(File).Slides("10").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))        With genericPowerPoint.Presentations(File).Slides("10").Shapes("Data")        .TextFrame.TextRange.Text = "Data from Bloomberg as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    End With        'update text legend     If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Alphabetic" Then         Sorted_By = "*Sorted alphabetically"     Else         Sorted_By = "*Sorted by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value)     End If     genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By              If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then         Sorted_By = "*Box Plot: sorted alphabetically"     Else         Sorted_By = "*Box Plot: sorted by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value)     End If     genericPowerPoint.Presentations(File).Slides("4").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By     genericPowerPoint.Presentations(File).Slides("6").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By     genericPowerPoint.Presentations(File).Slides("8").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By                    If wCurrentWbk.Sheets("3. Volatilities").Range("Percentile_OrderBy").Value = "Alphabetic" Then         Sorted_By = "*Table: sorted " & "alphabetically"     Else         Sorted_By = "*Table: sorted by " & LCase(wCurrentWbk.Sheets("3. Volatilities").Range("Percentile_OrderBy").Value)     End If          genericPowerPoint.Presentations(File).Slides("5").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By     genericPowerPoint.Presentations(File).Slides("7").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By     genericPowerPoint.Presentations(File).Slides("9").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By               If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Alphabetic" Then        Sorted_By = "*Sorted alphabetically"    Else        If wCurrentWbk.Sheets("3. Volatilities").Range("Summary_OrderBy").Value = "Percentile" Then            Sorted_By = "*Sorted by current value"        Else            Sorted_By = "*Sorted by percentile"        End If    End If    genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").TextFrame.TextRange.Text = Sorted_By            'Update title    's0        maturity_RVIV = CStr(Range("maturity_RV").Value)    stitle_graph = maturity_RVIV & "D REALIZED VOLATILITY"        genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value & "*"    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Font.Size = 13    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph & "*"    genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13        genericPowerPoint.Presentations(File).Slides("2").Shapes("Title_I").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value & "*"    genericPowerPoint.Presentations(File).Slides("2").Shapes("Title_I").TextFrame.TextRange.Font.Size = 13    genericPowerPoint.Presentations(File).Slides("2").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph & "*"    genericPowerPoint.Presentations(File).Slides("2").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13    stitle_graph = CStr(wCurrentWbk.Sheets("Vol Results").Range("Title1").Value)    moneyness = CStr(Replace(Range("moneyness_RV").Value, "%", "") * 100)        realized_vol_maturity = Range("maturity_RV").Value            's1: implied vs realized graph    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph & "*"    genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13        genericPowerPoint.Presentations(File).Slides("3").Shapes("Title_IR").TextFrame.TextRange.Text = stitle_graph & "*"    genericPowerPoint.Presentations(File).Slides("3").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13            's2 implied vol moves    genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Text = genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text    genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Font.Size = 13    's3    genericPowerPoint.Presentations(File).Slides("5").Shapes("Title").TextFrame.TextRange.Text = genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text    genericPowerPoint.Presentations(File).Slides("5").Shapes("Title").TextFrame.TextRange.Font.Size = 13    's4    genericPowerPoint.Presentations(File).Slides("6").Shapes("Title").TextFrame.TextRange.Text = CStr(wCurrentWbk.Sheets("Vol Results").Range("Title3").Value)    genericPowerPoint.Presentations(File).Slides("6").Shapes("Title").TextFrame.TextRange.Font.Size = 13    's5    genericPowerPoint.Presentations(File).Slides("7").Shapes("Title").TextFrame.TextRange.Text = CStr(wCurrentWbk.Sheets("Vol Results").Range("Title3").Value)    genericPowerPoint.Presentations(File).Slides("7").Shapes("Title").TextFrame.TextRange.Font.Size = 13    's6    genericPowerPoint.Presentations(File).Slides("8").Shapes("Title").TextFrame.TextRange.Text = CStr(wCurrentWbk.Sheets("Vol Results").Range("Title4").Value)    genericPowerPoint.Presentations(File).Slides("8").Shapes("Title").TextFrame.TextRange.Font.Size = 13    's7    genericPowerPoint.Presentations(File).Slides("9").Shapes("Title").TextFrame.TextRange.Text = CStr(wCurrentWbk.Sheets("Vol Results").Range("Title4").Value)    genericPowerPoint.Presentations(File).Slides("9").Shapes("Title").TextFrame.TextRange.Font.Size = 13                        '*********************************************************************    '    '    ' SLIDES                      0 and 1    '    '**********************************************************************    Application.StatusBar = "Powerpoint: slide 0"    ' update color scale        'The color scale refers to the green to red scale on slide 2 (graph)    ' the vol analysis macro creates a color scale using the exact number of ticker, so that it will match the color formatting in the table on slide 1    With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorV")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorV").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("B2").Resize(iStock1 - 1, 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)        .LockAspectRatio = False        .name = "ColorV"        .Height = hgt        .width = width        .left = left        .top = top    End With        With genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("1").Shapes("ColorH").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("D2").Resize(1, iStock1 - 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)        .LockAspectRatio = False        .name = "ColorH"        .Height = hgt        .width = width        .left = left        .top = top            End With                                '****************************************************************************************        '*************** Slide 1 : Implied vs realized   and implied level tables        '*****************************************************************************************            ' The all implied vs realized    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All").Delete        'get the implied realized table  from excel    'wCurrentWbk.Sheets("Vol Results").Range("Implied_Realized_All").CopyPicture    wCurrentWbk.Sheets("Vol Results").Range("B6").Resize(iStock1 + 1, 6).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)            .LockAspectRatio = False        .name = "Implied_Realized_All"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With            ' The all implied    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All").Delete        'get the implied realized table  from excel    'wCurrentWbk.Sheets("Vol Results").Range("Implied_All").CopyPicture    iOffset = (WorksheetFunction.Max(iStock1, 8) + 4)    wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 0).Resize(iStock1 + 1, 6).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_All"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With                ' The ratio    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio").Delete        'get the implied realized table  from excel    wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 7).Resize(iStock1 + 1, 3).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)        .LockAspectRatio = False        .name = "Vol_Ratio"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With        'adapt the legend        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Color")        .top = top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio").Height + 10    End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By")            .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Color").top - genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").Height * 0.5 + genericPowerPoint.Presentations(File).Slides("0").Shapes("Color").Height * 0.5    End With        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend1")        .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").Height * 0.85    End With    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Legend2")        .top = genericPowerPoint.Presentations(File).Slides("0").Shapes("Sorted_By").top    End With                '****************************************************************************************        '*************** Slide 1 : Implied vs realized   and implied level tables        '*****************************************************************************************     Application.StatusBar = "Powerpoint: slide 1"    genericPowerPoint.Presentations(File).Slides("1").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    'The Implied vs Realized graph    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart").Delete        'get the graph from excel    wCurrentWbk.Sheets("Vol_Scatter_Plots").Shapes("Volatility_Spread_ScatterPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_Realized_Chart"        .Height = hgt        .width = width        .left = left        .top = top        .LinkFormat.BreakLink    End With                                    '*********************************************************************    '    '    ' SLIDES                      2 and 3    '    '**********************************************************************        ' update color scale        'The color scale refers to the green to red scale on slide 2 (graph)    ' the vol analysis macro creates a color scale using the exact number of ticker, so that it will match the color formatting in the table on slide 1    With genericPowerPoint.Presentations(File).Slides("3").Shapes("ColorV")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("3").Shapes("ColorV").Delete        'get the graph from excel        wCurrentWbk.Sheets("Color Scales").Range("B2").Resize(iStock1 - 1, 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)        .LockAspectRatio = False        .name = "ColorV"        .Height = hgt        .width = width        .left = left        .top = top    End With        With genericPowerPoint.Presentations(File).Slides("3").Shapes("ColorH")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("3").Shapes("ColorH").Delete        'get the graph from excel    wCurrentWbk.Sheets("Color Scales").Range("D2").Resize(1, iStock1 - 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)        .LockAspectRatio = False        .name = "ColorH"        .Height = hgt        .width = width        .left = left        .top = top            End With                                '****************************************************************************************        '*************** Slide 1 : Implied vs realized   and implied level tables        '*****************************************************************************************      Application.StatusBar = "Powerpoint: slide 2"    ' The all implied vs realized    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Realized_All")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_Realized_All").Delete        'get the implied realized table  from excel    'wCurrentWbk.Sheets("Vol Results").Range("Implied_Realized_All").CopyPicture    wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(0, 2 * (iStock1 + 1) + 6 + 7).Resize(iStock1 + 1, 6).CopyPicture              ' wCurrentWbk.Sheets("Vol Results").Range("B6").Resize(iStock1 + 1, 6).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)            .LockAspectRatio = False        .name = "Implied_Realized_All"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With            ' The all implied    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_All")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_All").Delete        'get the implied realized table  from excel    'wCurrentWbk.Sheets("Vol Results").Range("Implied_All").CopyPicture    iOffset = (WorksheetFunction.Max(iStock1, 8) + 4)        wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 2 * (iStock1 + 1) + 6 + 7).Resize(iStock1 + 1, 6).CopyPicture            'wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 0).Resize(iStock1 + 1, 6).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_All"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With                ' The ratio    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Vol_Ratio")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("2").Shapes("Vol_Ratio").Delete        'get the implied realized table  from excel    wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 2 * (iStock1 + 1) + 6 + 7 + 6 + 1).Resize(iStock1 + 1, 3).CopyPicture    'wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset, 7).Resize(iStock1 + 1, 3).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint       genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)        .LockAspectRatio = False        .name = "Vol_Ratio"        .Height = Application.Min(hgt * iStock1 / iStock_Number_Template, 470)        .width = width        .left = left        .top = top            End With        'adapt the legend        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Color")        .top = top + genericPowerPoint.Presentations(File).Slides("0").Shapes("Vol_Ratio").Height + 10    End With        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By")            .top = genericPowerPoint.Presentations(File).Slides("2").Shapes("Color").top - genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").Height * 0.5 + genericPowerPoint.Presentations(File).Slides("2").Shapes("Color").Height * 0.5    End With        With genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend1")        .top = genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").top + genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").Height * 0.85    End With    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Legend2")        .top = genericPowerPoint.Presentations(File).Slides("2").Shapes("Sorted_By").top    End With    '****************************************************************************************        '*************** Slide 3 : Implied vs realized   and implied level tables        '*****************************************************************************************     Application.StatusBar = "Powerpoint: slide 3"    genericPowerPoint.Presentations(File).Slides("3").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))    'The Implied vs Realized graph    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Realized_Chart")        hgt = .Height        width = .width        left = .left        top = .top    End With        genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Realized_Chart").Delete        'get the graph from excel    wCurrentWbk.Sheets("Vol_Scatter_Plots").Shapes("Volatility_Spread_ScatterPlot_Value").Copy    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_Realized_Chart"        .Height = hgt        .width = width        .left = left        .top = top        .LinkFormat.BreakLink    End With                            'sort ticker to match user requirements        iNbStock = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value        Dim vImplied_Vol() As Variant    ReDim vImplied_Vol(1 To iNbStock + 1, 1 To 7) As Variant    vImplied_Vol(1, 1) = "Ticker Implied BP" 'ticker for implied volatility box plot    vImplied_Vol(1, 2) = "Name"    vImplied_Vol(1, 3) = "Ticker TS BP" 'ticker for ts box plot    vImplied_Vol(1, 4) = "Ticker Smile BP" 'ticker for smile box plot    vImplied_Vol(1, 5) = "Ticker Implied PT" ' ticker for implied vol percentile table    vImplied_Vol(1, 6) = "Ticker TS PT" 'ticker for ts percentile table    vImplied_Vol(1, 7) = "Ticker Smile PT" 'ticker for smile percentile table        Dim vorder() As Variant    ReDim vorder(1 To iNbStock, 1 To 2) As Variant    Dim icolumn As Integer    Dim bIncreasing As Boolean    If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then        icolumn = 1    Else        If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Current Value" Then            icolumn = 3        Else            icolumn = 6        End If    End If                            For i = 1 To iNbStock        vorder(i, 1) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(i, 0).Value        vorder(i, 2) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(i, icolumn - 1).Value    Next i        If wCurrentWbk.Sheets("3. Volatilities").Range("Select_IV").Value = "Top" Then        bIncreasing = False    Else        bIncreasing = True    End If    If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then        bIncreasing = True    End If    vorder = SortArray(vorder, 2, bIncreasing)        'implied volatility level    For i = 2 To iNbStock + 1        vImplied_Vol(i, 1) = vorder(i - 1, 1)        vImplied_Vol(i, 2) = Application.VLookup(vorder(i - 1, 1), wCurrentWbk.Sheets("Vol Results").Range("B7").Resize(iNbStock, 2).Value, 2, False)        vImplied_Vol(i, 5) = wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(0, i - 1).Value    Next i             'TS level    nb_vol = UBound(vImplied_Vol, 1) - 1    iOffset = 2 * (WorksheetFunction.Max(nb_vol, 7) + 4)        If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then        icolumn = 1    Else        If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Current Value" Then            icolumn = 5        Else            icolumn = 9        End If    End If                For i = 1 To iNbStock        vorder(i, 1) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset + i, 0).Value        vorder(i, 2) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset + i, icolumn - 1).Value    Next i    If wCurrentWbk.Sheets("3. Volatilities").Range("Select_TS").Value = "Top" Then        bIncreasing = False    Else        bIncreasing = True    End If    If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then        bIncreasing = True    End If    vorder = SortArray(vorder, 2, bIncreasing)        For i = 2 To iNbStock + 1        vImplied_Vol(i, 3) = vorder(i - 1, 1)        vImplied_Vol(i, 6) = wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, i - 1).Value    Next i        iOffset = 3 * (WorksheetFunction.Max(nb_vol, 7) + 4)        For i = 1 To iNbStock        vorder(i, 1) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset + i, 0).Value        vorder(i, 2) = wCurrentWbk.Sheets("Vol Results").Range("B6").Offset(iOffset + i, icolumn - 1).Value    Next i    If wCurrentWbk.Sheets("3. Volatilities").Range("Select_Skew").Value = "Top" Then        bIncreasing = False    Else        bIncreasing = True    End If    If wCurrentWbk.Sheets("3. Volatilities").Range("BoxPlot_OrderBy").Value = "Alphabetic" Then        bIncreasing = True    End If    vorder = SortArray(vorder, 2, bIncreasing)        For i = 2 To iNbStock + 1        vImplied_Vol(i, 4) = vorder(i - 1, 1)        vImplied_Vol(i, 7) = wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, i - 1).Value    Next i        '*********************************************************************    '    '    ' IMPLIED VOLATILITY BOX PLOT on SLIDE 3    '    '**********************************************************************        'Create first part of the bplot        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 1)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = vImplied_Vol(i + 1, 2)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        'Create second part of the bplot        'add 3 sheets to the ppt    Dim WS As Worksheet    Set WS = wCurrentWbk.Sheets.Add(After:=Sheets(Worksheets.Count))    WS.name = "Vol Results Bis"    Set WS = wCurrentWbk.Sheets.Add(After:=Sheets(Worksheets.Count))    WS.name = "Vol_Scatter_Plots Bis"    Set WS = wCurrentWbk.Sheets.Add(After:=Sheets(Worksheets.Count))    WS.name = "Vol_Box_Plots Bis"        'run the macro for the other tickers        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 1)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 1), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")            iStock1 = Round(iNbStock / 2, 0)    'Update the first box plot     Application.StatusBar = "Powerpoint: slide 4"     'The box plot 1    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Implied_BoxChart")        hgt = .Height        width = .width        left = .left        top = .top    End With            genericPowerPoint.Presentations(File).Slides("4").Shapes("Implied_BoxChart").Delete        'get the graph from excel    wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Implied_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))           'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)        'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count            With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)            .LockAspectRatio = False        .name = "Implied_BoxChart"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top        .LinkFormat.BreakLink            End With        'now do the second box plpt    iStock1 = iNbStock - Round(iNbStock / 2, 0)    'The box plot 2    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Implied_BoxChart2")        hgt = .Height        width = .width        left = .left        top = .top    End With            genericPowerPoint.Presentations(File).Slides("4").Shapes("Implied_BoxChart2").Delete        'get the graph from excel    wCurrentWbk.Sheets("Vol_Box_Plots Bis").Shapes("Implied_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)        'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count            With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)            .LockAspectRatio = False        .name = "Implied_BoxChart2"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top        .LinkFormat.BreakLink            End With   ''    '****************************************************************************************''    '*************** Slide 4: Implied Volatility percentiles''    '*****************************************************************************************         wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 5)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = Application.VLookup(vImplied_Vol(i + 1, 5), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")         wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 5)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 5), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")        Application.StatusBar = "Powerpoint: slide 5"    ' The implied percentile    iStock1 = Round(iNbStock / 2, 0)    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Implied_Percentile")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("5").Shapes("Implied_Percentile").Delete    'get the graph from excel     wCurrentWbk.Sheets("Vol Results").Range("N6").Resize(9, iStock1 + 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))            Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("5").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("5").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("5").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_Percentile"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With    ' The implied percentile 2    iStock1 = iNbStock - Round(iNbStock / 2, 0)        With genericPowerPoint.Presentations(File).Slides("5").Shapes("Implied_Percentile2")        hgt = .Height        left = .left        top = .top        width = .width    End With    genericPowerPoint.Presentations(File).Slides("5").Shapes("Implied_Percentile2").Delete    'get the graph from excel     wCurrentWbk.Sheets("Vol Results Bis").Range("N6").Resize(9, iStock1 + 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("5").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("5").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("5").Shapes(icount)        .LockAspectRatio = False        .name = "Implied_Percentile2"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With                    '*********************************************************************    '    '    ' SLIDES 5 : TS BOX PLOT    '    '**********************************************************************    Application.StatusBar = "Powerpoint: slide 6"    wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 3)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = Application.VLookup(vImplied_Vol(i + 1, 3), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 3)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 3), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")        iStock1 = Round(iNbStock / 2, 0)     'The box plot     'delete the graph in powerpoint     With genericPowerPoint.Presentations(File).Slides("6").Shapes("TS_BoxChart")         hgt = .Height         width = .width         left = .left         top = .top     End With     genericPowerPoint.Presentations(File).Slides("6").Shapes("TS_BoxChart").Delete     'get the graph from excel     wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Term_Structure_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))         'paste it into powerpoint     genericPowerPoint.Presentations(File).Slides("6").Shapes.PasteSpecial (ppPasteEnhancedMetafile)     'look for the last shape added in powerpoint     icount = genericPowerPoint.Presentations(File).Slides("6").Shapes.Count     'set the name, position and size     With genericPowerPoint.Presentations(File).Slides("6").Shapes(icount)         .LockAspectRatio = False         .name = "TS_BoxChart"         .Height = hgt         .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)         .left = (iSlideWidth - .width) / 2         .top = top         .LinkFormat.BreakLink     End With    ' do the 2nd graph     iStock1 = iNbStock - Round(iNbStock / 2, 0)     'The box plot 2     'delete the graph in powerpoint     With genericPowerPoint.Presentations(File).Slides("6").Shapes("TS_BoxChart2")         hgt = .Height         width = .width         left = .left         top = .top     End With     genericPowerPoint.Presentations(File).Slides("6").Shapes("TS_BoxChart2").Delete     'get the graph from excel     wCurrentWbk.Sheets("Vol_Box_Plots Bis").Shapes("Term_Structure_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))         'paste it into powerpoint     genericPowerPoint.Presentations(File).Slides("6").Shapes.PasteSpecial (ppPasteEnhancedMetafile)     'look for the last shape added in powerpoint     icount = genericPowerPoint.Presentations(File).Slides("6").Shapes.Count     'set the name, position and size     With genericPowerPoint.Presentations(File).Slides("6").Shapes(icount)         .LockAspectRatio = False         .name = "TS_BoxChart2"         .Height = hgt         .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)         .left = (iSlideWidth - .width) / 2         .top = top         .LinkFormat.BreakLink     End With               '*********************************************************************    '    '    ' SLIDES 6 : TS PERCENTILES    '    '**********************************************************************    wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 6)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = Application.VLookup(vImplied_Vol(i + 1, 6), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 6)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 6), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")        iStock1 = Round(iNbStock / 2, 0)    'The TS PERCENTILE    Application.StatusBar = "Powerpoint: slide 7"    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("7").Shapes("TS_Percentile")        hgt = .Height        width = .width        left = .left        top = .top    End With    genericPowerPoint.Presentations(File).Slides("7").Shapes("TS_Percentile").Delete    'get the graph from excel    iOffset = 2 * (WorksheetFunction.Max(iStock1, 7) + 4)    wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 0).Resize(9, iStock1 + 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("7").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("7").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("7").Shapes(icount)        .LockAspectRatio = False        .name = "TS_Percentile"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With            iStock1 = iNbStock - Round(iNbStock / 2, 0)    'The TS percentile 2    iOffset = 2 * (WorksheetFunction.Max(iStock1, 7) + 4)        'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("7").Shapes("TS_Percentile2")        hgt = .Height        width = .width        left = .left        top = .top    End With    genericPowerPoint.Presentations(File).Slides("7").Shapes("TS_Percentile2").Delete    'get the graph from excel        wCurrentWbk.Sheets("Vol Results Bis").Range("N6").Offset(iOffset, 0).Resize(9, iStock1 + 1).CopyPicture    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("7").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("7").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("7").Shapes(icount)        .LockAspectRatio = False        .name = "TS_Percentile2"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With    '*********************************************************************    '    '    ' SLIDES       7: SMILE BOX PLOT    '    '**********************************************************************    Application.StatusBar = "Powerpoint: slide 8"    wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 4)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = Application.VLookup(vImplied_Vol(i + 1, 4), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 4)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 4), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")        iStock1 = Round(iNbStock / 2, 0)          'The box plot     'delete the graph in powerpoint     With genericPowerPoint.Presentations(File).Slides("8").Shapes("Smile_BoxChart")         hgt = .Height         width = .width         left = .left         top = .top     End With     genericPowerPoint.Presentations(File).Slides("8").Shapes("Smile_BoxChart").Delete     'get the graph from excel     wCurrentWbk.Sheets("Vol_Box_Plots").Shapes("Smile_BoxPlot").Copy     Application.Wait (Now + TimeValue("00:00:01"))     'paste it into powerpoint     genericPowerPoint.Presentations(File).Slides("8").Shapes.PasteSpecial (ppPasteEnhancedMetafile)     'look for the last shape added in powerpoint     icount = genericPowerPoint.Presentations(File).Slides("8").Shapes.Count     'set the name, position and size     With genericPowerPoint.Presentations(File).Slides("8").Shapes(icount)         .LockAspectRatio = False         .name = "Smile_BoxChart"         .Height = hgt         .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)         .left = (iSlideWidth - .width) / 2         .top = top         .LinkFormat.BreakLink     End With               iStock1 = iNbStock - Round(iNbStock / 2, 0)     'The box plot2     'delete the graph in powerpoint     With genericPowerPoint.Presentations(File).Slides("8").Shapes("Smile_BoxChart2")         hgt = .Height         width = .width         left = .left         top = .top     End With     genericPowerPoint.Presentations(File).Slides("8").Shapes("Smile_BoxChart2").Delete     'get the graph from excel     wCurrentWbk.Sheets("Vol_Box_Plots Bis").Shapes("Smile_BoxPlot").Copy    Application.Wait (Now + TimeValue("00:00:01"))     'paste it into powerpoint     genericPowerPoint.Presentations(File).Slides("8").Shapes.PasteSpecial (ppPasteEnhancedMetafile)     'look for the last shape added in powerpoint     icount = genericPowerPoint.Presentations(File).Slides("8").Shapes.Count     'set the name, position and size     With genericPowerPoint.Presentations(File).Slides("8").Shapes(icount)         .LockAspectRatio = False         .name = "Smile_BoxChart2"         .Height = hgt         .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)         .left = (iSlideWidth - .width) / 2         .top = top         .LinkFormat.BreakLink     End With'    '****************************************************************************************''    '*************** Slide 8 :smile percentiles''    '*****************************************************************************************   Application.StatusBar = "Powerpoint: slide 9"   wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = 1 To Round(iNbStock / 2, 0)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 0).Value = vImplied_Vol(i + 1, 7)        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(i, 1).Value = Application.VLookup(vImplied_Vol(i + 1, 7), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results", "Vol_Scatter_Plots", "Vol_Box_Plots")        wCurrentWbk.Sheets("3. Volatilities").Range("B2").Offset(1, 0).Resize(50, 2).ClearContents    For i = Round(iNbStock / 2, 0) + 1 To iNbStock        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 0).Value = vImplied_Vol(i + 1, 7)        Sheets("3. Volatilities").Range("B2").Offset(i - Round(iNbStock / 2, 0), 1).Value = Application.VLookup(vImplied_Vol(i + 1, 7), vImplied_Vol, 2, False)    Next i        Call m_analyse("Vol Results Bis", "Vol_Scatter_Plots Bis", "Vol_Box_Plots Bis")        iStock1 = Round(iNbStock / 2, 0)          'The smile percentile    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("9").Shapes("Smile_Percentile")        hgt = .Height        width = .width        left = .left        top = .top    End With    genericPowerPoint.Presentations(File).Slides("9").Shapes("Smile_Percentile").Delete    'get the graph from excel    iOffset = 3 * (WorksheetFunction.Max(iStock1, 8) + 4)    wCurrentWbk.Sheets("Vol Results").Range("N6").Offset(iOffset, 0).Resize(9, iStock1 + 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))    'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("9").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("9").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("9").Shapes(icount)        .LockAspectRatio = False        .name = "Smile_Percentile"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With        iStock1 = iNbStock - Round(iNbStock / 2, 0)        'The smile percentile 2    'delete the graph in powerpoint    With genericPowerPoint.Presentations(File).Slides("9").Shapes("Smile_Percentile2")        hgt = .Height        width = .width        left = .left        top = .top    End With    genericPowerPoint.Presentations(File).Slides("9").Shapes("Smile_Percentile2").Delete    'get the graph from excel    iOffset = 3 * (WorksheetFunction.Max(iStock1, 8) + 4)    wCurrentWbk.Sheets("Vol Results Bis").Range("N6").Offset(iOffset, 0).Resize(9, iStock1 + 1).CopyPicture    Application.Wait (Now + TimeValue("00:00:01"))        'paste it into powerpoint    genericPowerPoint.Presentations(File).Slides("9").Shapes.PasteSpecial (ppPasteEnhancedMetafile)    'look for the last shape added in powerpoint    icount = genericPowerPoint.Presentations(File).Slides("9").Shapes.Count    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("9").Shapes(icount)        .LockAspectRatio = False        .name = "Smile_Percentile2"        .Height = hgt        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)        .left = (iSlideWidth - .width) / 2        .top = top    End With        Application.DisplayAlerts = False    wCurrentWbk.Sheets("Vol Results Bis").Delete    wCurrentWbk.Sheets("Vol_Scatter_Plots Bis").Delete    wCurrentWbk.Sheets("Vol_Box_Plots Bis").Delete            dt = Format(CStr(Now), "yyy_mm_dd_hh_mm_ss")    genericPowerPoint.Presentations(File).SaveAs (Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx")    wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(2, 1).Value = Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx"    genericPowerPoint.Quit    Application.StatusBar = "Powerpoint: saved"End SubSub MergePpt(iStock1, iStock2)    Dim wCurrentWbk As Workbook    Application.Wait (Now + TimeValue("00:00:05"))    Set wCurrentWbk = ActiveWorkbook    Dim sClientName As String    sClientName = ActiveWorkbook.Sheets("3. Volatilities").Range("Client").Value    Dim hgt As Double    Dim width, left, top, iSlideWidth As Double            ' Look for the path to the powerpoint presentations    Path = wCurrentWbk.Sheets("3. Volatilities").Range("Path_ppt").Value    File = wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_File").Value    Location = Path & "Template_Report_Long_test.pptx"            Dim genericPowerPoint As Object    Set genericPowerPoint = CreateObject("PowerPoint.Application")        genericPowerPoint.Visible = True        'Open the generic powerpoint long version    File = "Template_Long_Report.pptx"    Location = Path & File    genericPowerPoint.Presentations.Open Location    'rename slides    k = 0    For Each Slides In genericPowerPoint.Presentations(File).Slides        Slides.name = k        k = k + 1    Next    iSlideWidth = genericPowerPoint.Presentations(File).PageSetup.Slidewidth        'update fund name'    Dim hgt As Double'    Dim width, Left, top As Double        With genericPowerPoint.Presentations(File).Slides("0").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With    'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("1").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("2").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("4").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("5").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("6").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("7").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With        'set the name, position and size    With genericPowerPoint.Presentations(File).Slides("8").Shapes("Fund")        .TextFrame.TextRange.Text = sClientName    End With            'open the short version 1    File1 = wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(0, 1).Value    Location = File1    genericPowerPoint.Presentations.Open Location    'rename slides    k = 0    For Each Slides In genericPowerPoint.Presentations(File1).Slides        Slides.name = k        k = k + 1    Next        'open the short version 2    File2 = wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(1, 1).Value    Location = File2    genericPowerPoint.Presentations.Open Location    'rename slides    k = 0    For Each Slides In genericPowerPoint.Presentations(File2).Slides        Slides.name = k        k = k + 1    Next            Dim iStockNumber As Integer        iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value + 1        '****************************************************************************************        '*************** Slide 0 : Implied vs realized   and implied level tables        '*****************************************************************************************        'Update title        genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title1").Value        genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13        genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title2").Value        genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Font.Size = 13        genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title1").Value        genericPowerPoint.Presentations(File).Slides("1").Shapes("Title_IR").TextFrame.TextRange.Font.Size = 13        'Update date        Dim m_date As Date: m_date = wCurrentWbk.Sheets("3. Volatilities").Range("m_date").Value                genericPowerPoint.Presentations(File).Slides("0").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                ' The all implied vs realized 1                    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                        genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All").Delete                                        'get the graph from ppt 1                    genericPowerPoint.Presentations(File1).Slides("0").Shapes("Implied_Realized_All").Copy                                                        'paste it into powerpoint                                       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                    'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Implied_Realized_All"                        .Height = hgt * iStock1 / 16                        .width = width                        .left = left                        .top = top                                            End With            ' The all implied vs realized 2                    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All2")                            width = .width                            left = .left                            top = .top                        End With                                                genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_Realized_All2").Delete                                                'get the graph from ppt 1                        genericPowerPoint.Presentations(File2).Slides("0").Shapes("Implied_Realized_All").Copy                                                                    'paste it into powerpoint                                               genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                            'look for the last shape added in powerpoint                        icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                                                'set the name, position and size                        With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                                                    .LockAspectRatio = False                            .name = "Implied_Realized_All2"                            .Height = hgt * iStock2 / 16                            .width = width                            .left = left                            .top = top                                                    End With                            '******************************************************        ' The all implied                    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                        genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All").Delete                                        'get the graph from ppt 1                    genericPowerPoint.Presentations(File1).Slides("0").Shapes("Implied_All").Copy                                                        'paste it into powerpoint                                       genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                    'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Implied_All"                        .Height = hgt * iStock1 / 16                        .width = width                        .left = left                        .top = top                                            End With            ' The all implied                    With genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All2")                            left = .left                            top = .top                        End With                                                genericPowerPoint.Presentations(File).Slides("0").Shapes("Implied_All2").Delete                                                'get the graph from ppt 1                        genericPowerPoint.Presentations(File2).Slides("0").Shapes("Implied_All").Copy                                                                    'paste it into powerpoint                                               genericPowerPoint.Presentations(File).Slides("0").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                            'look for the last shape added in powerpoint                        icount = genericPowerPoint.Presentations(File).Slides("0").Shapes.Count                                                'set the name, position and size                        With genericPowerPoint.Presentations(File).Slides("0").Shapes(icount)                                                    .LockAspectRatio = False                            .name = "Implied_All2"                            .Height = hgt * iStock2 / 16                            .width = width                            .left = left                            .top = top                                                    End With                        '****************************************************************************************        '*************** Slide 1 : Implied vs realized   and implied level tables        '*****************************************************************************************            genericPowerPoint.Presentations(File).Slides("1").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))        'The Implied vs Realized graph        'delete the graph in powerpoint        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart")            hgt = .Height            width = .width            left = .left            top = .top        End With                genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart").Delete                'get the graph from excel        genericPowerPoint.Presentations(File1).Slides("0").Shapes("Implied_Realized_Chart").Copy                'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_Chart"            .Height = hgt            .width = width            .left = left            .top = top                    End With                            'The Implied vs Realized graph 2        'delete the graph in powerpoint        With genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart2")            hgt = .Height            width = .width            left = .left            top = .top        End With                genericPowerPoint.Presentations(File).Slides("1").Shapes("Implied_Realized_Chart2").Delete                'get the graph from excel        genericPowerPoint.Presentations(File2).Slides("0").Shapes("Implied_Realized_Chart").Copy                'paste it into powerpoint        genericPowerPoint.Presentations(File).Slides("1").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                'look for the last shape added in powerpoint        icount = genericPowerPoint.Presentations(File).Slides("1").Shapes.Count                'set the name, position and size        With genericPowerPoint.Presentations(File).Slides("1").Shapes(icount)                    .LockAspectRatio = False            .name = "Implied_Realized_Chart2"            .Height = hgt            .width = width            .left = left            .top = top                    End With                                                                    '****************************************************************************************        '*************** Slide 2 : Implied Volatility moves box plot        '*****************************************************************************************    genericPowerPoint.Presentations(File).Slides("2").Shapes("Title").TextFrame.TextRange.Text = genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text    genericPowerPoint.Presentations(File).Slides("2").Shapes("Title").TextFrame.TextRange.Font.Size = 13            'date    genericPowerPoint.Presentations(File).Slides("2").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))         'The box plot 1                'delete the graph in powerpoint                With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart")                    hgt = .Height                    width = .width                    left = .left                    top = .top                End With                                                genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart").Delete                                'get the graph from excel                genericPowerPoint.Presentations(File1).Slides("1").Shapes("Implied_BoxChart").Copy                                'paste it into powerpoint                genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                'look for the last shape added in powerpoint                icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count                                'set the name, position and size                iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value + 1                                With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)                                    .LockAspectRatio = False                    .name = "Implied_BoxChart"                    .Height = hgt                    .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                    .left = (iSlideWidth - .width) / 2                    .top = top                                    End With                   'The box plot 2                'delete the graph in powerpoint                With genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart2")                    left = .left                    top = .top                End With                                                genericPowerPoint.Presentations(File).Slides("2").Shapes("Implied_BoxChart2").Delete                                'get the graph from excel                genericPowerPoint.Presentations(File2).Slides("1").Shapes("Implied_BoxChart").Copy                                'paste it into powerpoint                genericPowerPoint.Presentations(File).Slides("2").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                'look for the last shape added in powerpoint                icount = genericPowerPoint.Presentations(File).Slides("2").Shapes.Count                                'set the name, position and size                iStockNumber = wCurrentWbk.Sheets("3. Volatilities").Range("nb_vol").Value + 1                                With genericPowerPoint.Presentations(File).Slides("2").Shapes(icount)                                    .LockAspectRatio = False                    .name = "Implied_BoxChart2"                    .Height = hgt                    .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                    .left = (iSlideWidth - .width) / 2                    .top = top                                    End With                '****************************************************************************************        '*************** Slide 3 : Implied Volatility moves charts        '*****************************************************************************************     genericPowerPoint.Presentations(File).Slides("3").Shapes("Title").TextFrame.TextRange.Text = genericPowerPoint.Presentations(File).Slides("0").Shapes("Title_I").TextFrame.TextRange.Text     genericPowerPoint.Presentations(File).Slides("3").Shapes("Title").TextFrame.TextRange.Font.Size = 13            'date    genericPowerPoint.Presentations(File).Slides("3").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))             ' The implied percentile                    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Percentile")                    hgt = .Height                    left = .left                    top = .top                    width = .width                End With                                genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Percentile").Delete                                'get the graph from excel                genericPowerPoint.Presentations(File1).Slides("1").Shapes("Implied_Percentile").Copy                                            'paste it into powerpoint                               genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                            'look for the last shape added in powerpoint                icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count                                 'set the name, position and size                With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)                                    .LockAspectRatio = False                    .name = "Implied_Percentile"                    .Height = hgt                    .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                    .left = (iSlideWidth - .width) / 2                    .top = top                                    End With                    ' The implied percentile 2                    With genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Percentile2")                                    top = .top                End With                                genericPowerPoint.Presentations(File).Slides("3").Shapes("Implied_Percentile2").Delete                                'get the graph from excel                genericPowerPoint.Presentations(File2).Slides("1").Shapes("Implied_Percentile").Copy                                            'paste it into powerpoint                               genericPowerPoint.Presentations(File).Slides("3").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                            'look for the last shape added in powerpoint                icount = genericPowerPoint.Presentations(File).Slides("3").Shapes.Count                                 'set the name, position and size                With genericPowerPoint.Presentations(File).Slides("3").Shapes(icount)                                    .LockAspectRatio = False                    .name = "Implied_Percentile2"                    .Height = hgt                    .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                    .left = (iSlideWidth - .width) / 2                    .top = top                                    End With                    '****************************************************************************************        '*************** Slide 4 : Term structure Level Box Plot        '*****************************************************************************************            genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title3").Value        genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Font.Size = 13               'Update title        genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title3").Value        genericPowerPoint.Presentations(File).Slides("4").Shapes("Title").TextFrame.TextRange.Font.Size = 13                k = 1       'date       genericPowerPoint.Presentations(File).Slides("4").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                'The box plot                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("4").Shapes("TS_BoxChart")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("4").Shapes("TS_BoxChart").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File1).Slides("2").Shapes("TS_BoxChart").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)                                            .LockAspectRatio = False                        .name = "TS_BoxChart"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                         'The box plot 2                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("4").Shapes("TS_BoxChart2")                        left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("4").Shapes("TS_BoxChart2").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File2).Slides("2").Shapes("TS_BoxChart").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("4").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("4").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("4").Shapes(icount)                                            .LockAspectRatio = False                        .name = "TS_BoxChart2"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With            '                                                    '****************************************************************************************        '*************** Slide 5 : Term structure Level => update graphs and tables        '*****************************************************************************************       'Update title        genericPowerPoint.Presentations(File).Slides("5").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title3").Value        genericPowerPoint.Presentations(File).Slides("5").Shapes("Title").TextFrame.TextRange.Font.Size = 13                'date       genericPowerPoint.Presentations(File).Slides("5").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                'The TS chart                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("5").Shapes("TS_Percentile")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("5").Shapes("TS_Percentile").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File1).Slides("2").Shapes("TS_Percentile").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("5").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("5").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("5").Shapes(icount)                                            .LockAspectRatio = False                        .name = "TS_Percentile"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                                            'The TS chart 2                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("5").Shapes("TS_Percentile2")                                                left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("5").Shapes("TS_Percentile2").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File2).Slides("2").Shapes("TS_Percentile").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("5").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("5").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("5").Shapes(icount)                                            .LockAspectRatio = False                        .name = "TS_Percentile2"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                    '****************************************************************************************        '*************** Slide 6 : Smile Level => update graphs and tables        '*****************************************************************************************       'Update title        genericPowerPoint.Presentations(File).Slides("6").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title4").Value        genericPowerPoint.Presentations(File).Slides("6").Shapes("Title").TextFrame.TextRange.Font.Size = 13                'date       genericPowerPoint.Presentations(File).Slides("6").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                'The S chart                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("6").Shapes("Smile_BoxChart")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("6").Shapes("Smile_BoxChart").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File1).Slides("3").Shapes("Smile_BoxChart").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("6").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("6").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("6").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Smile_BoxChart"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                                            'The S chart 2                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("6").Shapes("Smile_BoxChart2")                                               left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("6").Shapes("Smile_BoxChart2").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File2).Slides("3").Shapes("Smile_BoxChart").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("6").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("6").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("6").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Smile_BoxChart2"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                            '****************************************************************************************        '*************** Slide 7 : Smile Level => update  tables        '*****************************************************************************************       'Update title        genericPowerPoint.Presentations(File).Slides("7").Shapes("Title").TextFrame.TextRange.Text = wCurrentWbk.Sheets("Vol Results").Range("Title4").Value        genericPowerPoint.Presentations(File).Slides("7").Shapes("Title").TextFrame.TextRange.Font.Size = 13                'date       genericPowerPoint.Presentations(File).Slides("7").Shapes("Date").TextFrame.TextRange.Text = "Date as of " & CStr(Format(m_date, "mmmm dd, yyyy"))                'The S chart                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("7").Shapes("Smile_Percentile")                        hgt = .Height                        width = .width                        left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("7").Shapes("Smile_Percentile").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File1).Slides("3").Shapes("Smile_Percentile").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("7").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("7").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("7").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Smile_Percentile"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock1 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                                            'The S chart 2                    'delete the graph in powerpoint                    With genericPowerPoint.Presentations(File).Slides("7").Shapes("Smile_Percentile2")                                              left = .left                        top = .top                    End With                                                            genericPowerPoint.Presentations(File).Slides("7").Shapes("Smile_Percentile2").Delete                                        'get the graph from excel                    genericPowerPoint.Presentations(File2).Slides("3").Shapes("Smile_Percentile").Copy                                        'paste it into powerpoint                    genericPowerPoint.Presentations(File).Slides("7").Shapes.PasteSpecial (ppPasteEnhancedMetafile)                                        'look for the last shape added in powerpoint                    icount = genericPowerPoint.Presentations(File).Slides("7").Shapes.Count                                        'set the name, position and size                    With genericPowerPoint.Presentations(File).Slides("7").Shapes(icount)                                            .LockAspectRatio = False                        .name = "Smile_Percentile2"                        .Height = hgt                        .width = WorksheetFunction.Min(0.95 * iSlideWidth, width * iStock2 / 16)                        .left = (iSlideWidth - .width) / 2                        .top = top                                            End With                                                                                                                                        dt = Format(CStr(Now), "yyy_mm_dd_hh_mm_ss")        genericPowerPoint.Presentations(File).SaveAs (Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx")        If iShortppt = 1 Then            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(0, 1).Value = Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx"            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(1, 1).Value = ""        Else            wCurrentWbk.Sheets("3. Volatilities").Range("Ppt_short").Offset(2, 1).Value = Path & "Screener_Report_" & sClientName & "_" & dt & ".pptx"        End If                genericPowerPoint.Presentations("Screener_Report_" & sClientName & "_" & dt & ".pptx").Close        genericPowerPoint.QuitEnd SubFunction order(myarray() As Variant, column As Integer, orderby As String)Dim Temp() As VariantReDim Temp(UBound(myarray, 2))If orderby = "asc" Then    For i = 2 To UBound(myarray) - 1        For j = i + 1 To UBound(myarray)            If IsEmpty(myarray(i, column)) Or IsEmpty(myarray(j, column)) Then                        Else                If myarray(i, column) > myarray(j, column) Then                                For k = 1 To UBound(Temp)                        Temp(k) = myarray(j, k)                    Next k                                    For k = 1 To UBound(Temp)                        myarray(j, k) = myarray(i, k)                    Next k                                        For k = 1 To UBound(Temp)                        myarray(i, k) = Temp(k)                    Next k                End If            End If        Next j    Next iElseIf orderby = "desc" Then    For i = 2 To UBound(myarray)        For j = i + 1 To UBound(myarray)            If IsEmpty(myarray(i, column)) Or IsEmpty(myarray(j, column)) Then                        Else                If myarray(i, column) < myarray(j, column) Then                                        For k = 1 To UBound(Temp)                            Temp(k) = myarray(j, k)                        Next k                                            For k = 1 To UBound(Temp)                            myarray(j, k) = myarray(i, k)                        Next k                                                For k = 1 To UBound(Temp)                            myarray(i, k) = Temp(k)                        Next k                End If            End If        Next j    Next iEnd IfEnd Function        
